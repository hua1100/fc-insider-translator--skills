# è¿½è¸ªä¿®è®¢å•å…ƒæ ¼é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜å‘ç°

é€šè¿‡æ·±åº¦ XML åˆ†æå·¥å…·ï¼Œæˆ‘ä»¬å‘ç°äº†é—®é¢˜çš„çœŸæ­£æ ¹æºï¼š

### å•å…ƒæ ¼ç»“æ„åˆ†æ

**JSON åˆ†æç»“æœ**ï¼š
```json
{
  "total_runs": 0,
  "total_paragraphs": 1,
  "paragraphs": [
    {
      "text": "",
      "runs_count": 0
    }
  ]
}
```

**å®é™… XML ç»“æ„**ï¼š
```xml
<w:p>
  <w:del w:id="2" w:author="Claude" w:date="2025-11-05T07:09:20Z">
    <w:r>
      <w:delText>ç¥è³€ä½ å€‘å–å¾—é€™ä¸€éå‡¡çš„é‡Œç¨‹ç¢‘æˆå°±ï¼</w:delText>
    </w:r>
  </w:del>
  <w:ins w:id="3" w:author="Claude" w:date="2025-11-05T07:09:20Z">
    <w:r>
      <w:t>æ­å–œæ‚¨é”æˆéå‡¡é‡Œç¨‹ç¢‘!</w:t>
    </w:r>
  </w:ins>
</w:p>
```

### å…³é”®å‘ç°

1. **å•å…ƒæ ¼å·²ç»åŒ…å«è¿½è¸ªä¿®è®¢**ï¼š
   - `<w:del>` åŒ…å«åˆ é™¤çš„æ–‡æœ¬ï¼ˆæ—§ç¿»è¯‘ï¼‰
   - `<w:ins>` åŒ…å«æ’å…¥çš„æ–‡æœ¬ï¼ˆæ–°ç¿»è¯‘ï¼‰

2. **python-docx çš„å±€é™æ€§**ï¼š
   - `paragraph.runs` æ— æ³•è¯»å– `<w:del>` å’Œ `<w:ins>` ä¸­çš„ runs
   - è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‰€æœ‰ä¹‹å‰çš„è„šæœ¬éƒ½è¿”å›ç©ºå†…å®¹

3. **å¯èƒ½çš„åŸå› **ï¼š
   - æ–‡æ¡£ä¹‹å‰å·²ç»ç”¨å…¶ä»–å·¥å…·åº”ç”¨è¿‡è¿½è¸ªä¿®è®¢
   - æˆ–è€…ä¹‹å‰è¿è¡Œè¿‡æ›´æ–°è„šæœ¬

---

## âœ… è§£å†³æ–¹æ¡ˆ 4: `update_fc_insider_tracked.py`

è¿™ä¸ªè„šæœ¬ä¸“é—¨å¤„ç†å·²åŒ…å«è¿½è¸ªä¿®è®¢çš„å•å…ƒæ ¼ã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **ä»è¿½è¸ªä¿®è®¢ä¸­è¯»å–æ–‡æœ¬**ï¼š
   - `read_deleted` - ä» `<w:delText>` ä¸­è¯»å–ï¼ˆåˆ é™¤çš„æ–‡æœ¬ï¼‰
   - `read_inserted` - ä» `<w:ins>` ä¸­çš„ `<w:t>` è¯»å–ï¼ˆæ’å…¥çš„æ–‡æœ¬ï¼‰
   - `auto` - è‡ªåŠ¨æ£€æµ‹å¹¶é€‰æ‹©åˆé€‚çš„è¯»å–æ–¹æ³•

2. **æ¸…é™¤å¹¶é‡æ–°åº”ç”¨**ï¼š
   - æ¸…é™¤ç°æœ‰çš„è¿½è¸ªä¿®è®¢æ ‡è®°
   - åº”ç”¨æ–°çš„è¿½è¸ªä¿®è®¢

### ä½¿ç”¨æ–¹æ³•

#### åŸºæœ¬ç”¨æ³•ï¼ˆæ¨èï¼‰

```bash
python3 update_fc_insider_tracked.py \
  --input "/Users/hua/mdè…³æœ¬/FCInsider_Dec2025_Issue9_ç¿»è­¯ä¿®è¨‚ç‰ˆ.docx" \
  --translations "/Users/hua/mdè…³æœ¬/translations.json" \
  --output "/Users/hua/mdè…³æœ¬/output_tracked.docx" \
  --author "Gemini" \
  --mode auto \
  --verbose
```

**`--mode auto` ä¼šè‡ªåŠ¨æ£€æµ‹**ï¼š
1. å…ˆå°è¯•æ™®é€šè¯»å– (`cell.text`)
2. å¦‚æœä¸ºç©ºï¼Œå°è¯•ä» `<w:del>` è¯»å–
3. å¦‚æœè¿˜æ˜¯ç©ºï¼Œå°è¯•ä» `<w:ins>` è¯»å–
4. å‘Šè¯‰ä½ å®é™…ä½¿ç”¨äº†å“ªç§æ–¹æ³•

#### æŒ‡å®šè¯»å–æ¨¡å¼

**ä»åˆ é™¤çš„æ–‡æœ¬è¯»å–**ï¼ˆå¦‚æœä½ çš„ translations.json ä¸­çš„ old_translation æ¥è‡ª `<w:del>`ï¼‰ï¼š

```bash
python3 update_fc_insider_tracked.py \
  --input "input.docx" \
  --translations "translations.json" \
  --output "output.docx" \
  --author "Gemini" \
  --mode read_deleted \
  --verbose
```

**ä»æ’å…¥çš„æ–‡æœ¬è¯»å–**ï¼ˆå¦‚æœä½ çš„ translations.json ä¸­çš„ old_translation æ¥è‡ª `<w:ins>`ï¼‰ï¼š

```bash
python3 update_fc_insider_tracked.py \
  --input "input.docx" \
  --translations "translations.json" \
  --output "output.docx" \
  --author "Gemini" \
  --mode read_inserted \
  --verbose
```

---

## ğŸ¯ æ ¹æ®ä½ çš„æƒ…å†µ

ä»ä½ æä¾›çš„ XML æ¥çœ‹ï¼š

```xml
<w:del>
  <w:r>
    <w:delText>ç¥è³€ä½ å€‘å–å¾—é€™ä¸€éå‡¡çš„é‡Œç¨‹ç¢‘æˆå°±ï¼</w:delText>
  </w:r>
</w:del>
<w:ins>
  <w:r>
    <w:t>æ­å–œæ‚¨é”æˆéå‡¡é‡Œç¨‹ç¢‘!</w:t>
  </w:r>
</w:ins>
```

### åˆ¤æ–­ä½¿ç”¨å“ªç§æ¨¡å¼

æ£€æŸ¥ä½ çš„ `translations.json` ä¸­çš„ `old_translation` æ˜¯ä»€ä¹ˆï¼š

**å¦‚æœ old_translation æ˜¯**ï¼š`"ç¥è³€ä½ å€‘å–å¾—é€™ä¸€éå‡¡çš„é‡Œç¨‹ç¢‘æˆå°±ï¼"`
â†’ ä½¿ç”¨ `--mode read_deleted`

**å¦‚æœ old_translation æ˜¯**ï¼š`"æ­å–œæ‚¨é”æˆéå‡¡é‡Œç¨‹ç¢‘!"`
â†’ ä½¿ç”¨ `--mode read_inserted`

**å¦‚æœä¸ç¡®å®š**ï¼š
â†’ ä½¿ç”¨ `--mode auto --verbose`ï¼ˆè„šæœ¬ä¼šå‘Šè¯‰ä½ å®ƒä½¿ç”¨äº†å“ªç§æ–¹æ³•ï¼‰

---

## ğŸ“ ç¤ºä¾‹è¾“å‡º

è¿è¡Œ `--mode auto --verbose` æ—¶ï¼š

```
ğŸ“– åŠ è½½æ–‡æ¡£: input.docx
âœ“ æ–‡æ¡£å±‚çº§è¿½è¸ªä¿®è®¢å·²å­˜åœ¨

================================================================================
FC Insider ç¿»è¯‘æ›´æ–° - æ–¹æ¡ˆ 4 (å¤„ç†è¿½è¸ªä¿®è®¢)
è¯»å–æ¨¡å¼: auto
æ›´æ–°æ¨¡å¼: clear_and_replace
ä½œè€…: Gemini
ç¿»è¯‘æ•°é‡: 12
================================================================================

å¼€å§‹å¤„ç† 12 ä¸ªç¿»è¯‘...
================================================================================
[1/12] å¤„ç† 11d76b912e-c3c9-456c-a895-7f4778e6a43f...
    è‡ªåŠ¨æ£€æµ‹åˆ°æ–‡æœ¬æ¥æº: deleted
    å®é™…æ–‡æœ¬: 'ç¥è³€ä½ å€‘å–å¾—é€™ä¸€éå‡¡çš„é‡Œç¨‹ç¢‘æˆå°±ï¼'
  âœ“ æˆåŠŸ
[2/12] å¤„ç† 121d653fcd-c153-497f-836b-a37dc015504b...
    è‡ªåŠ¨æ£€æµ‹åˆ°æ–‡æœ¬æ¥æº: deleted
  âœ“ æˆåŠŸ
...
================================================================================
âœ“ æ›´æ–°å®Œæˆ: 12/12
================================================================================
```

---

## ğŸ”§ å·¥ä½œåŸç†

### è¯»å–é˜¶æ®µ

1. **è‡ªåŠ¨æ¨¡å¼** (`--mode auto`):
   ```python
   # 1. å°è¯•æ™®é€šè¯»å–
   normal_text = cell.text.strip()

   # 2. å¦‚æœä¸ºç©ºï¼Œä» <w:del> è¯»å–
   deleted_text = get_text_from_del_elements()

   # 3. å¦‚æœè¿˜æ˜¯ç©ºï¼Œä» <w:ins> è¯»å–
   inserted_text = get_text_from_ins_elements()
   ```

2. **æŒ‡å®šæ¨¡å¼**:
   - ç›´æ¥ä»æŒ‡å®šçš„ XML å…ƒç´ ä¸­æå–æ–‡æœ¬
   - ä½¿ç”¨ XPath æŸ¥æ‰¾ `<w:del>` æˆ– `<w:ins>` å…ƒç´ 

### æ›´æ–°é˜¶æ®µ

1. **æ¸…é™¤ç°æœ‰è¿½è¸ªä¿®è®¢**:
   ```python
   # ç§»é™¤æ‰€æœ‰ <w:del> å…ƒç´ 
   # ç§»é™¤ <w:ins> åŒ…è£…ï¼Œä¿ç•™å†…å®¹
   ```

2. **åº”ç”¨æ–°çš„è¿½è¸ªä¿®è®¢**:
   ```python
   # åˆ›å»ºæ–°çš„ <w:del> åŒ…å«æ—§æ–‡æœ¬
   # åˆ›å»ºæ–°çš„ <w:ins> åŒ…å«æ–°æ–‡æœ¬
   ```

---

## ğŸ†š ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”

| æ–¹æ¡ˆ | é€‚ç”¨æƒ…å†µ | èƒ½å¦å¤„ç†è¿½è¸ªä¿®è®¢ |
|------|---------|----------------|
| **æ–¹æ¡ˆ 1-3** | å•å…ƒæ ¼æ²¡æœ‰è¿½è¸ªä¿®è®¢ | âŒ ä¸èƒ½ |
| **æ–¹æ¡ˆ 4** | å•å…ƒæ ¼å·²åŒ…å«è¿½è¸ªä¿®è®¢ | âœ… èƒ½ |

**å…³é”®åŒºåˆ«**ï¼š
- æ–¹æ¡ˆ 1-3 ä½¿ç”¨ `paragraph.runs` è¯»å–ï¼ˆæ— æ³•è¯»å–è¿½è¸ªä¿®è®¢ä¸­çš„å†…å®¹ï¼‰
- æ–¹æ¡ˆ 4 ç›´æ¥è§£æ XMLï¼Œä» `<w:del>` å’Œ `<w:ins>` å…ƒç´ ä¸­æå–æ–‡æœ¬

---

## â“ FAQ

### Q1: æˆ‘æ€ä¹ˆçŸ¥é“æˆ‘çš„æ–‡æ¡£æ˜¯å¦å·²åŒ…å«è¿½è¸ªä¿®è®¢ï¼Ÿ

**A**: è¿è¡Œæ·±åº¦åˆ†æå·¥å…·ï¼š

```bash
python3 analyze_word_structure_deep.py \
  --input "input.docx" \
  --sample-segment "your-segment-id" \
  --export-xml
```

æŸ¥çœ‹å¯¼å‡ºçš„ XML æ–‡ä»¶ï¼Œå¦‚æœçœ‹åˆ° `<w:del>` å’Œ `<w:ins>` å…ƒç´ ï¼Œå°±è¯´æ˜å·²åŒ…å«è¿½è¸ªä¿®è®¢ã€‚

### Q2: auto æ¨¡å¼å’ŒæŒ‡å®šæ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**:
- **auto æ¨¡å¼**ï¼šè‡ªåŠ¨å°è¯•æ‰€æœ‰æ–¹æ³•ï¼Œé€‚åˆä¸ç¡®å®šæ–‡æ¡£ç»“æ„æ—¶ä½¿ç”¨
- **æŒ‡å®šæ¨¡å¼**ï¼šæ›´å¿«ï¼Œé€‚åˆä½ å·²ç»çŸ¥é“æ–‡æœ¬åœ¨å“ªé‡Œæ—¶ä½¿ç”¨

### Q3: å¦‚æœæˆ‘çš„ translations.json ä¸­çš„ old_translation ä¸åŒ¹é…æ€ä¹ˆåŠï¼Ÿ

**A**: ä¸¤ç§å¯èƒ½ï¼š

1. **old_translation æ¥è‡ªå¦ä¸€ä¸ªæ¥æº**ï¼š
   - æ£€æŸ¥ XML ä¸­ `<w:del>` å’Œ `<w:ins>` çš„å®é™…å†…å®¹
   - ç¡®ä¿ translations.json ä¸­çš„ old_translation åŒ¹é…å…¶ä¸­ä¹‹ä¸€

2. **éœ€è¦é‡æ–°ç”Ÿæˆ translations.json**ï¼š
   - ä½¿ç”¨æ–¹æ¡ˆ 4 çš„è¯»å–æ¨¡å¼åˆ›å»ºä¸€ä¸ªæå–å·¥å…·
   - ä»è¿½è¸ªä¿®è®¢ä¸­æå–å†…å®¹ç”Ÿæˆæ–°çš„ translations.json

### Q4: ä¸ºä»€ä¹ˆè¦æ¸…é™¤ç°æœ‰è¿½è¸ªä¿®è®¢ï¼Ÿ

**A**: å› ä¸ºï¼š
- é¿å…é‡å¤çš„è¿½è¸ªä¿®è®¢æ ‡è®°
- ç¡®ä¿è¿½è¸ªä¿®è®¢çš„ä½œè€…å’Œæ—¥æœŸæ˜¯ä¸€è‡´çš„
- ç®€åŒ– XML ç»“æ„

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: æ£€æŸ¥ä½ çš„ translations.json

æ‰“å¼€ `translations.json`ï¼ŒæŸ¥çœ‹ç¬¬ä¸€ä¸ªæ¡ç›®çš„ `old_translation`ï¼š

```json
{
  "segment_id": "11d76b912e-c3c9-456c-a895-7f4778e6a43f",
  "old_translation": "ç¥è³€ä½ å€‘å–å¾—é€™ä¸€éå‡¡çš„é‡Œç¨‹ç¢‘æˆå°±ï¼",
  "new_translation": "æ­å–œæ‚¨é”æˆéå‡¡é‡Œç¨‹ç¢‘!"
}
```

### æ­¥éª¤ 2: æ ¹æ® old_translation é€‰æ‹©æ¨¡å¼

**å¦‚æœ old_translation çœ‹èµ·æ¥åƒæ˜¯æ—§çš„ç¿»è¯‘**ï¼š
â†’ å¾ˆå¯èƒ½åœ¨ `<w:del>` ä¸­ï¼Œä½¿ç”¨ `--mode read_deleted`

**å¦‚æœ old_translation çœ‹èµ·æ¥åƒæ˜¯æ–°çš„ç¿»è¯‘**ï¼š
â†’ å¾ˆå¯èƒ½åœ¨ `<w:ins>` ä¸­ï¼Œä½¿ç”¨ `--mode read_inserted`

**å¦‚æœä¸ç¡®å®š**ï¼š
â†’ ä½¿ç”¨ `--mode auto`

### æ­¥éª¤ 3: è¿è¡Œè„šæœ¬

```bash
python3 update_fc_insider_tracked.py \
  --input "/Users/hua/mdè…³æœ¬/FCInsider_Dec2025_Issue9_ç¿»è­¯ä¿®è¨‚ç‰ˆ.docx" \
  --translations "/Users/hua/mdè…³æœ¬/translations.json" \
  --output "/Users/hua/mdè…³æœ¬/output_tracked.docx" \
  --author "Gemini" \
  --mode auto \
  --verbose
```

---

## ğŸ“Š æˆåŠŸæ ‡å¿—

è¿è¡ŒæˆåŠŸåï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

```
âœ“ æ›´æ–°å®Œæˆ: 12/12
```

æ‰€æœ‰ 12 ä¸ªç¿»è¯‘éƒ½åº”è¯¥æˆåŠŸæ›´æ–°ï¼

å¦‚æœè¿˜æœ‰å¤±è´¥çš„ï¼Œ`--verbose` æ¨¡å¼ä¼šå‘Šè¯‰ä½ ï¼š
- é¢„æœŸçš„æ–‡æœ¬æ˜¯ä»€ä¹ˆ
- å®é™…è¯»å–åˆ°çš„æ–‡æœ¬æ˜¯ä»€ä¹ˆ
- å¸®åŠ©ä½ è°ƒæ•´è¯»å–æ¨¡å¼

---

## ğŸ‰ æ€»ç»“

1. **é—®é¢˜æ ¹æº**ï¼šå•å…ƒæ ¼å·²åŒ…å«è¿½è¸ªä¿®è®¢ï¼Œpython-docx æ— æ³•è¯»å–
2. **è§£å†³æ–¹æ¡ˆ**ï¼šç›´æ¥ä» XML ä¸­çš„ `<w:del>` å’Œ `<w:ins>` å…ƒç´ è¯»å–
3. **æ¨èç”¨æ³•**ï¼š`--mode auto --verbose`
4. **é¢„æœŸç»“æœ**ï¼šæ‰€æœ‰ç¿»è¯‘éƒ½èƒ½æˆåŠŸæ›´æ–°

ç«‹å³è¿è¡Œè¯•è¯•ï¼ ğŸš€
